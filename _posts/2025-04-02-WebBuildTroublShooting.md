---
layout: single
comments: true
title:  "유니티에서 그리드 기반 직선 공격과 넉백 시스템 구현"
excerpt: "코드 학습"
categories: 
- 유니티
- 스파르타
tags:
- TIL
 
toc_label: 팀프로젝트
toc: true
toc_sticky: true
 
date: 2025-04-01
last_modified_at: 2025-04-01
---

### 📆 오늘의 TIL (Today I Learned)

## 유니티에서 그리드 기반 직선 공격과 넉백 시스템 구현

오늘은 유니티 2D 게임에서 그리드 기반 직선 공격 시스템과 넉백 스킬을 구현해 보았습니다. 이 시스템은 턴제 또는 전략 게임에서 유용하게 쓰일 수 있는 기능이  될 수 있을겁니다. 

기존 기능이 작동하지 않는 문제가 생겨 분석해보니

팀원들과 협업중 적 오브젝트가 겹쳐지게 하기 위해 isTrigger를 체크하게 되었고 이로 인해 기존의 넉백시스템이 적용되지 않았습니다.

이를 해결하기 위해 기존 공격시스템인 그리드 기반 타겟추적을 사용하여 콜라이더에 직접 충돌하지 않아도 넉백을 좌표를 이동하는것으로 구현하였습니다.

## 핵심 컨셉

### 1. 그리드 기반 직선 공격

- **행/열 방향성**: 가로(행) 또는 세로(열) 방향으로 공격 방향 설정 가능
- **범위 제한**: 그리드 단위로 공격 범위 설정
- **방향 우선순위**: 앞쪽 방향(오른쪽 또는 위쪽)에 있는 적만 공격 대상으로 설정

### 2. 효율적인 적 탐지 방법

- 넓은 범위 원형 검색 후 필터링: `Physics2D.OverlapCircleAll()`로 먼저 넓은 범위를 검색한 후, 그리드 위치를 기준으로 필터링
- 같은 행/열에 있는 적만 선별
- 거리 기반 우선순위: 가장 가까운 적을 우선 타겟팅

### 3. isTrigger 속성 처리

- Trigger Collider도 `Physics2D.OverlapCircleAll()`에 감지됨

- Rigidbody2D가 있는 Trigger 오브젝트의 경우 직접 위치 변경 방식 사용

  ```
  enemyRb.position = enemyRb.position + moveDirection;
  ```

- Rigidbody2D가 없는 경우 Transform으로 직접 이동

  ```
  transform.position += new Vector3(moveDirection.x, moveDirection.y, 0f);
  ```

## 구현 코드의 특징

1. 방향성 고려
   - `attackInRow` 변수로 공격 방향 설정
   - 행(가로) 또는 열(세로) 방향으로 공격 제한
2. 그리드 기반 범위 계산
   - 그리드 인덱스로 위치 변환: `UnitManager.Instance.GetGridIndex()`
   - 그리드 단위로 거리 계산
3. 넉백 효과 구현
   - 방향에 따른 넉백 벡터 설정
   - 물리 영향 초기화 후 직접 위치 변경
   - Trigger 상태와 관계없이 동작하도록 구현

## 개선점 및 추가 가능 기능

1. 다양한 방향 지원 (대각선, 모든 방향 등)
2. 넉백 거리를 대상과의 거리에 따라 동적으로 조절
3. 다중 타겟 공격 지원 (같은 라인의 여러 적을 한 번에 공격)
4. 장애물 감지 및 처리 기능

## 결론

그리드 기반 시스템에서 방향성과 범위를 고려한 공격 및 넉백 시스템은 턴제 또는 전략 게임에서 다양한 요소를 접할 수 있는데 적 탐지와 물리 시스템 처리를 통해 다양한 게임플레이 매커니즘을 구현할 수 있었습니다.

