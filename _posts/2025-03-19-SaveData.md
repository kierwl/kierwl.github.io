---
layout: single
comments: true
title:  "λ°μ΄ν„° λ§¤λ‹μ € "
excerpt: "μ λ‹ν‹° ν€ ν”„λ΅μ νΈ"
categories: 
- μ λ‹ν‹°
- μ¤νλ¥΄νƒ€
tags:
- TIL
 
toc_label: 3D νΌμ¦ μ”μ†
toc: true
toc_sticky: true
 
date: 2025-03-19
last_modified_at: 2025-03-19
---

### π“† μ¤λμ TIL (Today I Learned)

---

#### 1. **λ°μ΄ν„° μ €μ¥ (`SaveData<T>`)**

- μ…λ ¥λ λ°μ΄ν„° `T`λ¥Ό JSON λ¬Έμμ—΄λ΅ λ³€ν™ (`JsonConvert.SerializeObject`)
- AES μ•”νΈν™” μν–‰ (`Encrypt`)
- μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό νμΌμ— μ €μ¥ (`File.WriteAllText`)

#### 2. **λ°μ΄ν„° λ΅λ“ (`LoadData<T>`)**

- νμΌμ΄ μ΅΄μ¬ν•λ©΄ λ‚΄μ©μ„ μ½μ (`File.ReadAllText`)
- AES λ³µνΈν™” μν–‰ (`Decrypt`)
- JSONμ„ κ°μ²΄λ΅ λ³€ν™ (`JsonConvert.DeserializeObject<T>`)

#### 3. **λ°μ΄ν„° μ•”νΈν™” (`Encrypt`)**

- AES λ€μΉ­ν‚¤ μ•”νΈν™” λ°©μ‹ μ‚¬μ©
- 16λ°”μ΄νΈ IV(μ΄κΈ°ν™” λ²΅ν„°) μƒμ„± ν›„ λ°μ΄ν„° μ•”νΈν™”
- IVλ¥Ό μ•”νΈν™”λ λ°μ΄ν„° μ•μ— λ¶™μ—¬ Base64λ΅ λ³€ν™ ν›„ λ°ν™

#### 4. **λ°μ΄ν„° λ³µνΈν™” (`Decrypt`)**

- Base64 λ¬Έμμ—΄μ„ λ°”μ΄νΈ λ°°μ—΄λ΅ λ³€ν™
- μ•λ¶€λ¶„μ—μ„ IV(16λ°”μ΄νΈ) μ¶”μ¶ ν›„, λ‚λ¨Έμ§€ λ°μ΄ν„° λ³µνΈν™”
- λ³µνΈν™”λ λ°μ΄ν„° UTF-8 λ¬Έμμ—΄ λ°ν™

#### 5. **λ°μ΄ν„° κµ¬μ΅° (`GameData`)**

- `LastClearedChapter` ν•„λ“λ¥Ό ν¬ν•¨ν•μ—¬ κ²μ„ μ§„ν–‰ μ •λ³΄λ¥Ό μ €μ¥ν•λ” ν΄λμ¤

```
using System.Collections;
using System.Collections.Generic;
using UnityEngine;
using Newtonsoft.Json;
using System.IO;
using System.Security.Cryptography;
using System.Text;
using System;

public class DataManager : Singleton<DataManager>
{
    private static readonly byte[] key = Encoding.UTF8.GetBytes("dI19vfsdf2341bP2");

    public static T LoadData<T>(string filePath)
    {
        if(File.Exists(Application.persistentDataPath + filePath))
        {
            string loaded = File.ReadAllText(Application.persistentDataPath + filePath);
            if (loaded == null)
            {
                throw new System.NullReferenceException();
            }

            string context = Decrypt(loaded);
            T Data = JsonConvert.DeserializeObject<T>(context);

            return Data;
        }
        else
        {
            return default;
        }
    }

    public static void SaveData<T>(T data, string filePath)
    {
        string context = JsonConvert.SerializeObject(data);
        context = Encrypt(context);
        File.WriteAllText(Application.persistentDataPath + filePath, context);
    }

    public static string Encrypt(string plainText)
    {
        using (Aes aes = Aes.Create())
        {
            aes.Key = key;
            aes.GenerateIV();

            ICryptoTransform encryptor = aes.CreateEncryptor(aes.Key, aes.IV);
            byte[] bytesToEncrypt = Encoding.UTF8.GetBytes(plainText);

            // μ•”νΈν™” 
            byte[] encryptedData = encryptor.TransformFinalBlock(bytesToEncrypt, 0, bytesToEncrypt.Length);

            // IVλ¥Ό λ°μ΄ν„° μ•μ— λ§λ¶™μ„
            byte[] result = new byte[aes.IV.Length + encryptedData.Length];
            Array.Copy(aes.IV, 0, result, 0, aes.IV.Length);
            Array.Copy(encryptedData, 0, result, aes.IV.Length, encryptedData.Length);

            return Convert.ToBase64String(result);
        }
    }

    public static string Decrypt(string encryptedString)
    {
        byte[] encryptedData = Convert.FromBase64String(encryptedString);

        using(Aes aes = Aes.Create())
        {
            aes.Key = key;

            //IV λ³µκµ¬
            byte[] iv = new byte[aes.IV.Length];
            byte[] realEncrytedContext = new byte[encryptedData.Length - iv.Length];
            Array.Copy(encryptedData, 0, iv, 0, iv.Length);
            Array.Copy(encryptedData, iv.Length, realEncrytedContext, 0, realEncrytedContext.Length);

            // λ³µνΈν™” 
            aes.IV = iv;
            ICryptoTransform decrytor = aes.CreateDecryptor(aes.Key, aes.IV);
            byte[] decryptedData = decrytor.TransformFinalBlock(realEncrytedContext, 0, realEncrytedContext.Length);

            return Encoding.UTF8.GetString(decryptedData);
        }
    }
}

public class GameData
{
    public int LastClearedChapter;
}

```

#### **AES μ•”νΈν™”λ¥Ό ν™μ©ν• λ°μ΄ν„° μ €μ¥ λ°©μ‹**

- Unityμ—μ„ κ²μ„ λ°μ΄ν„°λ¥Ό μ €μ¥ν•  λ• λ³΄μ•μ„ μ„ν•΄ AES μ•”νΈν™”λ¥Ό μ μ©ν•  μ μλ‹¤.
- μ•”νΈν™”λ λ°μ΄ν„°λ” JSON ν•νƒλ΅ λ³€ν™ ν›„ νμΌμ— μ €μ¥ν•λ©°, λ³µνΈν™” μ‹ λ‹¤μ‹ κ°μ²΄λ΅ λ³€ν™ν•λ‹¤.

#### π”Ή **AES μ•”νΈν™” κµ¬ν„ μ‹ κ³ λ ¤ν•  μ **

1. **IV(Initialization Vector)μ μ¤‘μ”μ„±**
   - AES μ•”νΈν™”λ” λ™μΌν• μ…λ ¥ κ°’μ— λ€ν•΄ μ„λ΅ λ‹¤λ¥Έ μ•”νΈλ¬Έμ„ μƒμ„±ν•κΈ° μ„ν•΄ IVλ¥Ό μ‚¬μ©ν•λ‹¤.
   - IVλ” μ•”νΈν™”λ λ°μ΄ν„° μ•μ— μ €μ¥λλ©°, λ³µνΈν™” μ‹ μ΄λ¥Ό μ¬λ°”λ¥΄κ² μ¶”μ¶ν•΄μ•Ό ν•λ‹¤.
2. **AES ν‚¤ λ³΄μ• λ¬Έμ **
   - ν•λ“μ½”λ”©λ ν‚¤λ” λ³΄μ•μƒ μ·¨μ•½ν•λ―€λ΅ `PlayerPrefs`, ν™κ²½ λ³€μ, λλ” `SecureStorage` ν™μ©μ΄ ν•„μ”ν•λ‹¤.
3. **νμΌ μ…μ¶λ ¥ μμ™Έ μ²λ¦¬ ν•„μ”**
   - `File.Exists`λ¥Ό μ‚¬μ©ν•  λ• μ ‘κ·Ό κ¶ν• λ¬Έμ λ΅ μμ™Έκ°€ λ°μƒν•  μ μμ.
   - `try-catch`λ¥Ό ν™μ©ν•μ—¬ μ•μ •μ„±μ„ λ†’μ΄λ” κ²ƒμ΄ μΆ‹λ‹¤.

#### π”Ή **Unityμ—μ„ JSON λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² μ €μ¥ν•λ” λ°©λ²•**

- λ‹¨μν• JSON μ €μ¥μ€ λ³΄μ•μƒ μ„ν—ν•λ―€λ΅ AES μ•”νΈν™”λ¥Ό μ μ©ν•λ” κ²ƒμ΄ μΆ‹λ‹¤.
- AES μ•”νΈν™” λ°©μ‹μ€ IVμ™€ ν‚¤λ¥Ό μ μ ν κ΄€λ¦¬ν•΄μ•Ό μ•μ „ν•κ² λ°μ΄ν„°λ¥Ό λ³΄νΈν•  μ μλ‹¤.
